<!DOCTYPE html>

<!-- index.html Simple frontend interface for the project. Allows the user to enter "from" and "to" stops,
 shows live suggestions, and sends a POST request to the backend (/search) to get route data. Displays the route, distance
 arrival, and mode of transposrtation (bus number).  Includes local test data (STOPS) for autocomplete functionality.-->
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>User Input</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px }
        input, button { margin: 5px; padding: 5px }
        #output { margin-top: 10px; font-weight: bold }
        .suggestions {
            border: 1px solid #ccc;
            max-height: 150px;
            overflow-y: auto;
            position: absolute;
            background: white;
            z-index: 1;
        }
    .suggestion-item {
            padding: 5px;
        cursor: pointer;
    }
    .suggestion-item:hover {
        background-color: #f0f0f0;
    }
    </style>
</head>
<body>
    <h2>Enter Transport Route</h2>
    <form id="transportForm">
        <label for="from">From:</label><br>
        <input type="text" id="from" name="from" required autocomplete="off"><br><br>
        <label for="to">To:</label><br>
        <input type="text" id="to" name="to" required autocomplete="off"><br><br>
        <label>
            <input type="checkbox" id="onlyWithRoof" name="onlyWithRoof">
            Show stops with roof
        </label><br><br>
        <button type="submit">Submit</button>
    </form>
    <div id="output"></div>

    <!-- this stop info is just for test -->
 <script>
     const STOPS = [
         { name: "Fredrikstad", x: 0.0, y: 0.0 },
         { name: "Ostfoldhallen", x: 5.0, y: 0.0 },
         { name: "Greaaker", x: 0.0, y: 3.0 },
         { name: "Amfi Borg", x: 3.0, y: 3.0 },
         { name: "Torsbekke", x: 10.0, y: 0.0 },
     ];

     function showSuggestions(inputId, suggestionsId) {
         const input = document.getElementById(inputId);
         const suggestionsDiv = document.getElementById(suggestionsId);
         const query = input.value.toLowerCase();

         suggestionsDiv.innerHTML = '';
         if (query) {
             const filteredStops = STOPS.filter(stop =>
                 stop.name.toLowerCase().includes(query)
             );
             filteredStops.forEach(stop => {
                 const div = document.createElement('div');
                 div.className = 'suggestion-item';
                 div.textContent = stop.name;
                 div.onclick = () => {
                     input.value = stop.name;
                     suggestionsDiv.innerHTML = '';
                 };
                 suggestionsDiv.appendChild(div);
             });
             suggestionsDiv.style.display = filteredStops.length ? 'block' : 'none';
         } else {
             suggestionsDiv.style.display = 'none';
         }
     }

     document.addEventListener('click', (event) => {
         const fromSuggestions = document.getElementById('from-suggestions');
         const toSuggestions = document.getElementById('to-suggestions');
         if (!event.target.closest('#transportForm')) {
             fromSuggestions.style.display = 'none';
             toSuggestions.style.display = 'none';
         }
     });

     <!-- submit form handle-->
     function handleSubmit(event) {
         event.preventDefault();
         const from = document.getElementById("from").value;
         const to = document.getElementById("to").value;
         const onlyWithRoof = document.getElementById("onlyWithRoof").checked;

         if (from && to && from !== to) {
             fetch('/search', {
                 method: 'POST',
                 headers: {'Content-Type': 'application/x-www-form-urlencoded'},
                 body: `from=${encodeURIComponent(from)}&to=${encodeURIComponent(to)}&onlyWithRoof=${onlyWithRoof}`
             })
                 .then(response => {
                     if (!response.ok) throw new Error('Network response was not ok');
                     return response.json();
                 })
                 .then(data => {
                     const formatTime = (datetime) => {
                        if (!datetime || datetime === "N/A") return "N/A";
                        const parts = datetime.split('T');
                        return parts.length > 1 ? parts[1].substring(0, 5) : datetime;

                     };
                     document.getElementById('output').innerHTML = `
                        Route: From ${data.route},
                        Distance: ${data.distance.toFixed(2)} km,
                        Departure: ${formatTime(data.departure)},
                        Arrival: ${formatTime(data.arrival)},
                        Mode: ${data.bus || 'N/A'}
                    `;
                 })
                 .catch(error => {
                     console.error('Error:', error);
                     document.getElementById('output').innerHTML = `Error: ${error.message}`;
                 });
         } else {
             document.getElementById('output').innerHTML = 'Please select different start and destination stops.';
         }
     }

     document.getElementById('from').addEventListener('input', () => {
         showSuggestions('from', 'from-suggestions');
     });
     document.getElementById('to').addEventListener('input', () => {
         showSuggestions('to', 'to-suggestions');
     });

     document.getElementById('transportForm').addEventListener('submit', function(event) {
         event.preventDefault();
         handleSubmit(event);
     });
 </script>
    <div id="from-suggestions" class="suggestions" style="display: none;"></div>
    <div id="to-suggestions" class="suggestions" style="display: none;"></div>

</body>
</html>